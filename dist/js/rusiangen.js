var husbandArray=["Adalbert of Babenberg","Almos of Hungary","Andrej Volodimerič","Andrew of Hungary","Baškord of the Polovcians","Béla I of Hungary","Béla II of Hungary",'Bolesław "the Tall" of Poland',"Bolesław II of Poland","Bolesław III of Poland","Bolesław IV of Poland","Boris Kolomanovič","Brjačeslav Davidič",'Casimir "the Restorer" of Poland',"Cuno of Beichlingen",'Edward "the Exile" of England',"Eric Emune of Denmark","Erling Skaki of Norway","Géza II of Hungary","Glěb Jurevič","Glěb Rostislavič","Glěb Vseslavič","Gunther Count of Keffenberg",'Harald "Hardrada" Sigurtharsson of Norway',"Henry I Capet",'Henry III "the Long" of Stade',"Henry IV of the German Empire","Hugh of Vermandois","Iakus of Miechów","Izjaslav Jaroslavič","Izjaslav M′stislavič","Jaropolk Izjaslavič","Jaropolk Svjatoslavič","Jaropolk Volodimerič",'Jaroslav "Mudryj" Volodimerič',"Jaroslav Svjatopolčič","Jaroslav Volodimerkovič",'Jurij "Dolgorukij" Volodimerič',"Jurij Jaroslavič","Knud Lavard Ericsson","Koloman of Hungary","Ladislaus of Hungary","Leo Diogenes of Byzantium","M′stislav Harald Volodimerič","M′stislav Jurevič",'Magnus "the Blind" Sigurdsson of Norway',"Malcolm III of Scotland","Mieszko II of Poland","Mieszko of Poland","N. N. of Byzantium","Olav Sveinsson","Oleg Svjatoslavič","Philip of France","Piotr Wlostowic","Raoul de Crepy","Rogvolod Borisič","Roman Rostislavič","Roman Volodimerič","Rostislav Glěbovič","Rostislav Volodimerič","Salomon of Hungary",'Sigurd "the Crusader" of Norway',"Soběslav of Bohemia","Stig Whiteskin of Denmark","Svjatopolk M′stislavič","Svjatoslav Jaroslavič","Svjatoslav Ol′govič","Svjatoslav Volodimerič","Svjatoslav Vsevolodič","Volodimer Davidič","Volodimer Monomax Vsevolodič","Volodimer Svjatoslavič","Volodimer Vsevolodič","Volodimerko Volodarič","Vratislav II of Bohemia","Vratislav of Bohemia",'Vsevolod "Big Nest" Jurevič',"Vsevolod Jaroslavič","Vsevolod Ol′govič","Vsevolod Svjatoslavič","Vsevolodko Davidič","Władysław Herman","Władysław II of Poland"],placesArray=["Bamberg","Bilhorod","Bryansk","Busk","Chernihiv","Constantinople","Cracow","Denmark","Dorohobuzh","Edinburgh","Esztergom","Gniezno","Halych","Kyiv","London","Mainz","Minsk","Norway","Novgorod","Novhorod-Sivers'kyi","Paris","Pereyaslav","Polack","Polovtsy","Przemyśl","Ryazan","Schleswig","Smolensk","Turov","Vermandois","Vladimir-Suzdal","Volodymyr"];dojo.ready(function(){$.each(husbandArray,function(e,a){$("#dropDownCountry").append($("<option></option>").val(a).html(a))}),$.each(placesArray,function(e,a){$("#dropDownPlace").append($("<option></option>").val(a).html(a))}),$(".dropdown-toggle").dropdown(),$(".selectpicker").selectpicker(),$("#hSlider").slider({}),$("#about").click(function(){$("#aboutModal").modal("show"),$("body").css("margin-right","0px"),$(".navbar").css("margin-right","0px")})});var map,featureLayer,basemapURL="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/basemap/MapServer",placeLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/0",husbandwifeLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/1",countryLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/2";require(["esri/map","application/bootstrapmap","esri/layers/FeatureLayer","esri/dijit/Legend","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/renderers/SimpleRenderer","esri/layers/ArcGISTiledMapServiceLayer","esri/geometry/Point","dojo/on","esri/symbols/TextSymbol","esri/layers/LabelLayer","esri/Color","dojo/domReady!"],function(e,a,r,o,t,i,s,n,l,d,u,c,b,f,m,p){function g(){return map.extent.getWidth()/map.width}function y(){var e=new i(i.STYLE_CIRCLE,6,new s(s.STYLE_SOLID,new p([250,0,0,1]),1),new p([250,0,0,1])),a=new l(e),o=new r(placeLayer,{mode:r.MODE_SNAPSHOT,outFields:["name_stylesheet"]});o.setRenderer(a),map.addLayer(o);var t=new p("#ff0000"),n=(new f).setColor(t);n.font.setSize("8pt"),n.font.setFamily("arial"),n.font.setStyle("italic");var u=new d(n),c=new m({id:"labels_place"});c.addFeatureLayer(o,u,"{name_stylesheet}"),map.addLayer(c)}function v(){map.enableScrollWheelZoom();var e=new s(s.STYLE_SHORTDOT,new esri.Color([80,80,80]),2.5),a=new l(e,"HusbandNam");featureLayer=new r(husbandwifeLayer,{mode:r.MODE_SNAPSHOT,maxAllowableOffset:g(),outFields:["*"],supportsAdvancedQueries:!0}),featureLayer.setRenderer(a),featureLayer.setOpacity(.9),map.addLayer(featureLayer);dojo.connect(map,"onClick",function(e){console.log(e.graphic),map.graphics.clear();var a=new esri.geometry.Point(e.mapPoint.x,e.mapPoint.y,e.mapPoint.spatialReference),r=map.extent.getWidth(),o=r/map.width,i=10*o,n=new esri.geometry.Extent(1,1,i,i,e.mapPoint.spatialReference);n.geometry=n.centerAt(a);var l=featureLayer.selectFeatures(n,esri.layers.FeatureLayer.SELECTION_NEW);l.then(function(e){if($(".alert").length>0)for(var a=$(".alert").length-1;a>=0;a--)$(".alert")[a].remove();for(var r=function(){},a=e.length-1;a>=0;a--)r.info=function(e){$("#alert_placeholder").append('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+e+"</span></div>")},r.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+e[a].attributes.HusbandNam+"</li><li><b>Place:</b> "+e[a].attributes.HusbandPla+"</li><li><b>Wife:</b> "+e[a].attributes.WifeName+"</li><li><b>Place:</b> "+e[a].attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+e[a].attributes.YearofMarr+"</li><li><a href='"+e[a].attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>');if(e.length>0){var o=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),i=new t(e[0].geometry,o);map.graphics.add(i)}},function(e){console.log("select features error: ",e)})})}function h(){S();var e=document.getElementsByClassName("tooltip-inner")[0].childNodes[0].nodeValue.split(" : ")[0],a=document.getElementsByClassName("tooltip-inner")[0].childNodes[0].nodeValue.split(" : ")[1];$(".dropdown-toggle").contents()[1].nodeValue=" Years: "+e+"-"+a,featureLayer.setDefinitionExpression("year >= "+e+"AND year <="+a)}function S(){for(var e=husbandArray.length-1;e>=0;e--)$("#dropDownCountry").children('option[value="'+husbandArray[e]+'"]').show();for(var e=placesArray.length-1;e>=0;e--)$("#dropDownPlace").children('option[value="'+placesArray[e]+'"]').show()}function w(){map.graphics.clear();var e=document.getElementsByClassName("tooltip-inner")[0].childNodes[0].nodeValue.split(" : ")[0],a=document.getElementsByClassName("tooltip-inner")[0].childNodes[0].nodeValue.split(" : ")[1];console.log(e,a),dojo.forEach(featureLayer.graphics,function(r){if(r.attributes.HusbandNam==$("select option:selected")[0].value&&r.attributes.year>=e&&r.attributes.year<=a)if(console.log(r.attributes),r.attributes.Shape_Length<10){var o={HusbandNam:r.attributes.HusbandNam,HusbandPla:r.attributes.HusbandPla,HusbandPag:r.attributes.HusbandPag,WifeName:r.attributes.WifeName,WifePlace:r.attributes.WifePlace,YearofMarr:r.attributes.YearofMarr},i={geometry:{points:[[r.attributes.HusbandX,r.attributes.HusbandY]],spatialReference:4326},attributes:o,symbol:{color:[255,255,0,185],size:14,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[204,225,0],width:2,type:"esriSLS",style:"esriSLSSolid"}}},n=new t(i);map.graphics.add(n)}else{var l={HusbandNam:r.attributes.HusbandNam,HusbandPla:r.attributes.HusbandPla,HusbandPag:r.attributes.HusbandPag,WifeName:r.attributes.WifeName,WifePlace:r.attributes.WifePlace,YearofMarr:r.attributes.YearofMarr},d=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),u=new t(r.geometry,d,l);map.graphics.add(u)}dojo.connect(map.graphics,"onMouseOver",function(e){console.log(e.graphic.attributes.HusbandNam);var a=function(){};a.info=function(e){$("#alert_placeholder").html('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+e+"</span></div>")},a.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+e.graphic.attributes.HusbandNam+"</li><li><b>Place:</b> "+e.graphic.attributes.HusbandPla+"</li><li><b>Wife:</b> "+e.graphic.attributes.WifeName+"</li><li><b>Place:</b> "+e.graphic.attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+e.graphic.attributes.YearofMarr+"</li><li><a href='"+e.graphic.attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>')})})}function P(){map.graphics.clear(),dojo.forEach(featureLayer.graphics,function(e){if(e.attributes.HusbandPla==$("select option:selected")[1].value||e.attributes.WifePlace==$("select option:selected")[1].value)if(console.log(e.attributes),e.attributes.Shape_Length<10){var a={HusbandNam:e.attributes.HusbandNam,HusbandPla:e.attributes.HusbandPla,HusbandPag:e.attributes.HusbandPag,WifeName:e.attributes.WifeName,WifePlace:e.attributes.WifePlace,YearofMarr:e.attributes.YearofMarr},r={geometry:{points:[[e.attributes.HusbandX,e.attributes.HusbandY]],spatialReference:4326},attributes:a,symbol:{color:[255,255,0,185],size:14,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[204,225,0],width:2,type:"esriSLS",style:"esriSLSSolid"}}},o=new t(r);map.graphics.add(o)}else{var i={HusbandNam:e.attributes.HusbandNam,HusbandPla:e.attributes.HusbandPla,HusbandPag:e.attributes.HusbandPag,WifeName:e.attributes.WifeName,WifePlace:e.attributes.WifePlace,YearofMarr:e.attributes.YearofMarr},n=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),l=new t(e.geometry,n,i);map.graphics.add(l)}dojo.connect(map.graphics,"onMouseOver",function(e){var a=function(){};a.info=function(e){$("#alert_placeholder").html('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+e+"</span></div>")},a.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+e.graphic.attributes.HusbandNam+"</li><li><b>Place:</b> "+e.graphic.attributes.HusbandPla+"</li><li><b>Wife:</b> "+e.graphic.attributes.WifeName+"</li><li><b>Place:</b> "+e.graphic.attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+e.graphic.attributes.YearofMarr+"</li><li><a href='"+e.graphic.attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>')})})}map=a.create("mapDiv",{center:[25,53.4],zoom:4,smartNavigation:!0});var H=new u(basemapURL);dojo.connect(map,"onLoad",v),dojo.connect(map,"onLoad",y),dojo.connect(map,"onZoomEnd",function(){var e=g();featureLayer.setMaxAllowableOffset(e),console.log(map.getZoom()),map.getZoom()<4&&map.setZoom(4),map.getZoom()>8&&map.setZoom(8)}),map.addLayer(H);var L=new s(s.STYLE_SOLID,new esri.Color([152,152,152]),1),N=new l(L),M=new r(countryLayer,{mode:r.MODE_SNAPSHOT,outFields:["CNTRY_NAME"]});M.setRenderer(N);var I=new p("#666"),k=(new f).setColor(I);k.font.setSize("8pt"),k.font.setFamily("arial"),k.font.setStyle("italic");var E=new d(k),V=new m({id:"labels_cnty"});V.addFeatureLayer(M,E,"{CNTRY_NAME}"),$("#checkbox2").click(function(){console.log(this.checked),1==this.checked?(map.addLayer(M),map.addLayer(V)):(map.removeLayer(M),map.removeLayer(V))}),$("#hSlider").slider().on("slideStop",function(){h();var e=husbandArray,a=placesArray;featureLayer.on("UpdateEnd",function(){for(var r=featureLayer.toJson(),o=r.featureSet.features.length-1;o>=0;o--)console.log(r.featureSet.features[o].attributes.HusbandPla),e=$.grep(e,function(e){return e!=r.featureSet.features[o].attributes.HusbandNam}),a=$.grep(a,function(e){return e!=r.featureSet.features[o].attributes.HusbandPla});for(var o=e.length-1;o>=0;o--)$("#dropDownCountry").children('option[value="'+e[o]+'"]').hide();for(var o=a.length-1;o>=0;o--)$("#dropDownPlace").children('option[value="'+a[o]+'"]').hide();$(".selectpicker").selectpicker("refresh")})}),$("#dropDownCountry").on("change",function(){w()}),$("#dropDownPlace").on("change",function(){P()}),function(e,a,r,o,t,i,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,i=a.createElement(r),s=a.getElementsByTagName(r)[0],i.async=1,i.src=o,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-46421302-1","auto"),ga("send","pageview")});