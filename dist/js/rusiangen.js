var husbandArray=["Adalbert of Babenberg","Almos of Hungary","Andrei Volodimerich","Andrew of Hungary","Bashkord of the Polovtsy","Bela I of Hungary","Bela II of Hungary",'Boleslaw "the Tall" of Poland',"Boleslaw II of Poland","Boleslaw III of Poland","Boleslaw IV of Poland","Boris Kolomanovich","Briacheslav Davidich",'Casimir "the Restorer" of Poland',"Cuno of Beichlingen",'Edward "the Exile" of England',"Eric Emune of Denmark","Erling Skaki of Norway","Geza II of Hungary","Gleb Iurevich","Gleb Rostislavich","Gleb Vseslavich","Gunther Count of Keffenberg",'Harald "Hardrada" Sigurtharsson of Norway',"Henry I Capet",'Henry III "the Long" of Stade',"Henry IV of the German Empire","Hugh of Vermandois","Iakus of Mekhov","Iaropolk Iziaslavich","Iaropolk Sviatoslavich","Iaropolk Volodimerich",'Iaroslav "Mudryi" Volodimerich',"Iaroslav Sviatopolchich","Iaroslav Vladimirkovich",'Iurii "Dolgorukii" Volodimerich',"Iurii Iaroslavich","Iziaslav Iaroslavich","Iziaslav Mstislavich","Knud Lavard Ericsson","Koloman of Hungary","Ladislaus of Hungary","Leo Diogenes of Byzantium",'Magnus "the Blind" Sigurdsson of Norway',"Malcolm III of Scotland","Mieszko II of Poland","Mieszko of Poland","Mstislav Harald Volodimerich","Mstislav Iurevich","N. N. of Byzantium","Olav Sveinsson","Oleg Sviatoslavich","Philip of France","Piotr Wlostowic","Raoul de Crepy","Rogvolod Borisich","Roman Rostislavich","Roman Volodimerich","Rostislav Glebovich","Rostislav Volodimerich","Salomon of Hungary",'Sigurd "the Crusader" of Norway',"Sobeslav of Bohemia","Stig Whiteskin of Denmark","Sviatopolk Mstislavich","Sviatoslav Iaroslavich","Sviatoslav Olgovich","Sviatoslav Volodimerich","Sviatoslav Vsevolodich","Vladimir Monomakh Vsevolodich","Vladimirko Volodarich","Volodimer Davidich","Volodimer Sviatoslavich","Volodimer Vsevolodich","Vratislav II of Bohemia","Vratislav of Bohemia",'Vsevolod "Big Nest" Iurevich',"Vsevolod Iaroslavich","Vsevolod Olgovich","Vsevolod Sviatoslavich","Vsevolodko Davidich","Wladyslaw Herman","Wladyslaw II of Poland","Adelaide, daughter of Almos of Hungary","Adele of Vermandois","Adelheid, daughter of Andrew of Hungary","Agafia Iaroslavna","Agafija Rostislavna","Agafija Volodimerovna","Agnes of the German Empire","Anastasia Iaroslavna",'Anna "Porphyrogenita" of Byzantium',"Anna Iaroslavna","Bertha of Holland","Bertrada of Anjou","Bulgar Woman","Cunigunda of the German Empire","Dobronega-Maria Volodimerovna","Elena, daughter of the ruler of the Ossetians","Elisabeth Iaroslavna","Evfimiia Volodimerovna","Evfrosiniia Mstislavna","Evpraksia Vsevolodovna","First Czech woman of Bohemia","Gertrude of Poland","Greek nun of Byzantium","Gyda Haroldsdottir","Hedwig, daughter of Almos of Hungary","Ingeborg Mstislavna","Ingigerd of Norway","Ingigerd of Sweden","Jelena daughter of Uros I of Serbia","Judith, daughter of Henry III of the German Empire","Judith, daughter of Vratislav II of Bohemia","Kristin Ingesdottir of Sweden","Kristin Knudsdottir of Denmark","Kristin Sigurdsdottir of Norway","Lanka daughter of Bela I of Hungary","Malfrid Mstislavna","Margaret of England","Margret Knudsdottir","Maria Mstislavna","Maria of Ossetia","Maria Sviatopolkovna","Maria Sviatoslavna","Maria Volodimerovna","Monomaxina",'N. N. "Evdoksia" Iziaslavna','N. N. "Olga" Iurevna','N. N. "Premislava" Volodimerovna',"N. N. Andreevna","N. N. Glebovna","N. N. Iaropolkovna","N. N. Iziaslavna","N. N. Jurevna","N. N. Komnena","N. N. Mstislavna","N. N. of Moravia","N. N. Petrovna of Poland","N. N. Rostislavna","N. N. Sviatoslavna","N. N. Vasilkovna","N. N. Volodarovna","N. N. Vsevolodkovna","N. N., daughter of Khan Aepa","N. N., daughter of Koloman","N. N., daughter of Mstislav Volodimerich","N. N., daughter of the Tsar of Abkhaz","N. N., grandaughter of Tugorkhan of the Polovcians","Oda of Stade","Peredslava Sviatopolkovna","Petrovna Mikhailovitsa","Richeza of Poland","Richeza of the German Empire","Rogned'","Sbyslava Sviatopolkovna","Second Czech woman of Bohemia","Sofia Iaroslavna","Sviatoslava of Poland","Unknown daughter of Dmitrii Zavidich","Unknown daughter of Ladislaus of Hungary","Unknown Daughter of Mieszko II of Poland","Unknown daughter of Wladyslaw Herman of Poland","Vierchoslava Mstislavna","Vysheslava Sviatoslavna","Zvenislava Vsevolodovna"],placesArray=["Abkhazia","Amsterdam","Anjou","Bamberg","Bilhorod","Bryansk","Bulgar","Busk","Byzantium","Chernihiv","Constantinople","Cracow","Denmark","Dorohobuzh","Edinburgh","England","Esztergom","France","German Empire","Gniezno","Halych","Hungary","Kyiv","London","Mainz","Minsk","Norway","Novgorod","Novhorod","Sivers'kyi","Ossetia","Paris","Peremyshl","Pereyaslav","Polack","Poland","Polovtsy","Raska","Rus'","Ryazan","Schleswig","Scotland","Serbia","Smolensk","Stockholm","Sweden","Turov","Vermandois","Vladimir","Suzdal","Volodymyr","Vyshhorod"];dojo.ready(function(){$(window).load(function(){$("#aboutModal").modal("show")}),$.each(husbandArray,function(a,e){$("#dropDownCountry").append($("<option></option>").val(e).html(e))}),$.each(placesArray,function(a,e){$("#dropDownPlace").append($("<option></option>").val(e).html(e))}),$("div.dropdown-menu").on("click",function(a){a.stopPropagation()}),$(".selectpicker").selectpicker({container:"body"}),$("body").on("click",function(a){var e=$(a.target);e.parents(".bootstrap-select").length&&(a.stopPropagation(),$(".bootstrap-select.open").removeClass("open"))}),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?$(".selectpicker").selectpicker("mobile"):$(".selectpicker").selectpicker(),$("#about").click(function(){$("#aboutModal").modal("show"),$("body").css("margin-right","0px"),$(".navbar").css("margin-right","0px")})});var map,featureLayer,basemapURL="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genbasemap/MapServer",placeLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/0",husbandwifeLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/1",countryLayer="http://cga2.cga.harvard.edu/arcgis/rest/services/rusgen/genhusbandwife/MapServer/2";require(["esri/map","application/bootstrapmap","esri/layers/FeatureLayer","esri/dijit/HomeButton","esri/dijit/Legend","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/renderers/SimpleRenderer","esri/layers/ArcGISTiledMapServiceLayer","esri/geometry/Point","dojo/on","esri/symbols/TextSymbol","esri/layers/LabelLayer","esri/Color","dojo/domReady!"],function(a,e,o,r,t,i,n,s,l,d,u,c,f,m,h,b,g){function p(){return map.extent.getWidth()/map.width}function v(){var a=new n(n.STYLE_CIRCLE,6,new s(s.STYLE_SOLID,new g([237,85,101,1]),1),new g([237,85,101,1])),e=new d(a),r=new o(placeLayer,{mode:o.MODE_SNAPSHOT,outFields:["name_stylesheet"]});r.setRenderer(e),map.addLayer(r);var t=new g("#ED5565"),i=(new h).setColor(t).setOffset(-5,-17).setAlign(h.ALIGN_START);i.font.setSize("8pt"),i.font.setFamily("arial"),i.font.setStyle("italic");var l=new u(i),c=new b({id:"labels_place"});c.addFeatureLayer(r,l,"{name_stylesheet}"),map.addLayer(c)}function y(){map.enableScrollWheelZoom();var a=new s(s.STYLE_SHORTDOT,new esri.Color([80,80,80]),2.5),e=new d(a,"HusbandNam");featureLayer=new o(husbandwifeLayer,{id:"husband_graphic",mode:o.MODE_SNAPSHOT,maxAllowableOffset:p(),outFields:["*"],supportsAdvancedQueries:!0}),featureLayer.setRenderer(e),featureLayer.setOpacity(.9),map.addLayer(featureLayer),dojo.connect(map,"onClick",function(a){console.log(a.graphic),$("#dropDownPlace").selectpicker("val","Select a Place..."),$("#dropDownCountry").selectpicker("val","Select a Name..."),map.graphics.clear();var e=new esri.geometry.Point(a.mapPoint.x,a.mapPoint.y,a.mapPoint.spatialReference),o=map.extent.getWidth(),r=o/map.width,t=10*r,n=new esri.geometry.Extent(1,1,t,t,a.mapPoint.spatialReference);n.geometry=n.centerAt(e);var l=featureLayer.selectFeatures(n,esri.layers.FeatureLayer.SELECTION_NEW);l.then(function(a){if($(".alert").length>0)for(var e=$(".alert").length-1;e>=0;e--)$(".alert")[e].remove();for(var o=function(){},e=a.length-1;e>=0;e--)o.info=function(a){$("#alert_placeholder").append('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+a+"</span></div>")},o.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+a[e].attributes.HusbandNam+"</li><li><b>Place:</b> "+a[e].attributes.HusbandPla+"</li><li><b>Wife:</b> "+a[e].attributes.WifeName+"</li><li><b>Place:</b> "+a[e].attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+a[e].attributes.YearofMarr+"</li><li><a href='"+a[e].attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>');if(a.length>0){var r=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),t=new i(a[0].geometry,r);map.graphics.add(t)}},function(a){console.log("select features error: ",a)})})}function S(){for(var a=husbandArray.length-1;a>=0;a--)$("#dropDownCountry").children('option[value="'+husbandArray[a]+'"]').show();for(var a=placesArray.length-1;a>=0;a--)$("#dropDownPlace").children('option[value="'+placesArray[a]+'"]').show()}function w(){map.graphics.clear(),dojo.forEach(featureLayer.graphics,function(a){if(a.attributes.HusbandNam==$("select option:selected")[0].value||a.attributes.WifeName==$("select option:selected")[0].value)if(a.attributes.Shape_Length<10){var e={HusbandNam:a.attributes.HusbandNam,HusbandPla:a.attributes.HusbandPla,HusbandPag:a.attributes.HusbandPag,WifeName:a.attributes.WifeName,WifePlace:a.attributes.WifePlace,YearofMarr:a.attributes.YearofMarr},o={geometry:{points:[[a.attributes.HusbandX,a.attributes.HusbandY]],spatialReference:4326},attributes:e,symbol:{color:[255,255,0,185],size:14,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[204,225,0],width:2,type:"esriSLS",style:"esriSLSSolid"}}},r=new i(o);map.graphics.add(r)}else{var t={HusbandNam:a.attributes.HusbandNam,HusbandPla:a.attributes.HusbandPla,HusbandPag:a.attributes.HusbandPag,WifeName:a.attributes.WifeName,WifePlace:a.attributes.WifePlace,YearofMarr:a.attributes.YearofMarr},n=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),l=new i(a.geometry,n,t);map.graphics.add(l)}dojo.connect(map.graphics,"onMouseOver",function(a){if("undefined"!=typeof a.graphic.attributes){var e=function(){};e.info=function(a){$("#alert_placeholder").html('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+a+"</span></div>")},e.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+a.graphic.attributes.HusbandNam+"</li><li><b>Place:</b> "+a.graphic.attributes.HusbandPla+"</li><li><b>Wife:</b> "+a.graphic.attributes.WifeName+"</li><li><b>Place:</b> "+a.graphic.attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+a.graphic.attributes.YearofMarr+"</li><li><a href='"+a.graphic.attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>')}})})}function N(){map.graphics.clear(),dojo.forEach(featureLayer.graphics,function(a){if(a.attributes.HusbandPla==$("select option:selected")[1].value||a.attributes.WifePlace==$("select option:selected")[1].value||a.attributes.HusbandKing==$("select option:selected")[1].value||a.attributes.WifeKingdo==$("select option:selected")[1].value)if(console.log(a.attributes),a.attributes.Shape_Length<10){var e={HusbandNam:a.attributes.HusbandNam,HusbandPla:a.attributes.HusbandPla,HusbandPag:a.attributes.HusbandPag,WifeName:a.attributes.WifeName,WifePlace:a.attributes.WifePlace,YearofMarr:a.attributes.YearofMarr},o={geometry:{points:[[a.attributes.HusbandX,a.attributes.HusbandY]],spatialReference:4326},attributes:e,symbol:{color:[255,255,0,185],size:14,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[204,225,0],width:2,type:"esriSLS",style:"esriSLSSolid"}}},r=new i(o);map.graphics.add(r)}else{var t={HusbandNam:a.attributes.HusbandNam,HusbandPla:a.attributes.HusbandPla,HusbandPag:a.attributes.HusbandPag,WifeName:a.attributes.WifeName,WifePlace:a.attributes.WifePlace,YearofMarr:a.attributes.YearofMarr},n=new s(s.STYLE_SOLID,new dojo.Color([255,255,0,.7]),4),l=new i(a.geometry,n,t);map.graphics.add(l)}dojo.connect(map.graphics,"onMouseOver",function(a){if("undefined"!=typeof a.graphic.attributes){var e=function(){};e.info=function(a){$("#alert_placeholder").html('<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert">&times</button><span>'+a+"</span></div>")},e.info("<ul class='alertCountryInfo'><li><b>Husband:</b> "+a.graphic.attributes.HusbandNam+"</li><li><b>Place:</b> "+a.graphic.attributes.HusbandPla+"</li><li><b>Wife:</b> "+a.graphic.attributes.WifeName+"</li><li><b>Place:</b> "+a.graphic.attributes.WifePlace+"</li><li><b>Year of Marriage:</b> "+a.graphic.attributes.YearofMarr+"</li><li><a href='"+a.graphic.attributes.HusbandPag+'\' target="_blank">http://genealogy.obdurodon.org</a></li></ul>')}})})}map=e.create("mapDiv",{center:[25,53.4],zoom:4,smartNavigation:!0});var P=new r({map:map},"HomeButton");P.startup();var H=new c(basemapURL);dojo.connect(map,"onLoad",y),dojo.connect(map,"onLoad",v),dojo.connect(map,"onZoomEnd",function(){var a=p();featureLayer.setMaxAllowableOffset(a),console.log(map.getZoom()),map.getZoom()<4&&map.setZoom(4),map.getZoom()>8&&map.setZoom(8)}),map.addLayer(H);var I=new s(s.STYLE_SOLID,new esri.Color([152,152,152]),1),k=new d(I),L=new o(countryLayer,{mode:o.MODE_SNAPSHOT,outFields:["CNTRY_NAME"]});L.setRenderer(k);var M=new g("#666"),A=(new h).setColor(M);A.font.setSize("8pt"),A.font.setFamily("arial"),A.font.setStyle("italic");var V=new u(A),E=new b({id:"labels_cnty"});E.addFeatureLayer(L,V,"{CNTRY_NAME}"),$("#checkbox2").click(function(){console.log(this.checked),1==this.checked?(map.addLayer(L),map.addLayer(E)):(map.removeLayer(L),map.removeLayer(E))}),$(function(){$("#range").ionRangeSlider({hide_min_max:!0,keyboard:!0,min:980,max:1209,from:980,to:1209,type:"double",step:1,prefix:"",grid:!0,grid_num:6,prettify_enabled:!1,onFinish:function(a){console.log(a.from),S(),featureLayer.setDefinitionExpression("year >= "+a.from+"AND year <="+a.to);var e=husbandArray,o=placesArray;featureLayer.on("UpdateEnd",function(){for(var a=featureLayer.toJson(),r=a.featureSet.features.length-1;r>=0;r--)console.log(a.featureSet.features[r].attributes.HusbandPla),e=$.grep(e,function(e){return e!=a.featureSet.features[r].attributes.HusbandNam&&e!=a.featureSet.features[r].attributes.WifeName}),o=$.grep(o,function(e){return e!=a.featureSet.features[r].attributes.HusbandPla&&e!=a.featureSet.features[r].attributes.WifePlace&&e!=a.featureSet.features[r].attributes.HusbandKing&&e!=a.featureSet.features[r].attributes.WifeKingdo});for(var r=e.length-1;r>=0;r--)$("#dropDownCountry").children('option[value="'+e[r]+'"]').hide();for(var r=o.length-1;r>=0;r--)$("#dropDownPlace").children('option[value="'+o[r]+'"]').hide();$(".selectpicker").selectpicker("refresh")})}})}),$("#dropDownCountry").on("change",function(){w(),$("div.alert").remove(),$("#dropDownPlace").selectpicker("val","Select a Place...")}),$("#dropDownPlace").on("change",function(){N(),$("div.alert").remove(),$("#dropDownCountry").selectpicker("val","Select a Name...")}),function(a,e,o,r,t,i,n){a.GoogleAnalyticsObject=t,a[t]=a[t]||function(){(a[t].q=a[t].q||[]).push(arguments)},a[t].l=1*new Date,i=e.createElement(o),n=e.getElementsByTagName(o)[0],i.async=1,i.src=r,n.parentNode.insertBefore(i,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-46421302-1","auto"),ga("send","pageview")});